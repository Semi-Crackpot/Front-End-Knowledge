# 闭包

### 什么是闭包？
- 有权访问另一个函数作用域中的变量的函数

### 如何创建一个闭包
- 在一个函数内部，创建另一个函数
  ```js
  function func() {
    var a = 1, b = 2
    function closure() {
      return a + b
    }
    // closure就是一个闭包
    return closure
  }
  ```
- 闭包的作用域链，包含它自己的作用域链，以及包含它的函数的作用域和全局作用域

### 闭包的特点
1.  通常，函数的作用域以及所有变量都会在函数执行结束后被销毁，但闭包的作用域会保存到闭包不存在为止
  ```js
  var func = function() {
    var a = 1;
    return function() {
      a++;
      console.log(a);
    }
  }
  var f = func();
  f(); // 2
  f(); // 3
  f(); // 4
  f = null; // 通过置为null，来释放对闭包的引用
  f(); // 报错
  ```

### 闭包的应用
1.  防抖函数
2.  设计单例模式
  ```js
  class CreateUser {
    constructor(name) {
        this.name = name;
        this.getName();
    }
    getName() {
        return this.name;
    }
  }
  // 代理实现单例模式
  var ProxyMode = (function() {
    var instance = null;
    return function(name) {
        if(!instance) {
            instance = new CreateUser(name);
        }
        return instance;
    }
  })();
  // 单例模式的实例
  var a = ProxyMode("aaa");
  var b = ProxyMode("bbb");
  // 因为单体模式是只实例化一次，所以下面的实例是相等的
  console.log(a === b);    //true
  ```
3.  设置私有变量
  ```js
  let sque = (function () {
    let _width = Symbol();
    class Squery {
        constructor(s) {
            this[_width] = s
        }
        foo() {
            console.log(this[_width])
        }
    }
    return Squery
  })();
  let sq = new sque(20);
  sq.foo(); // 20
  console.log(sq[_width]) // 报错，因为是私有变量
  ```

### 闭包的缺点
1.  闭包中的变量会常驻内存，造成内存泄露