# 模块

### 模块的作用
1.  组织应用程序的结构

### 安装
1.  安装模块：``nest g module module/admin``，模块文件放在src/admin目录中，admin是模块名称
2.  安装之后，会自动在根模块``app.module.ts``中，引入安装好的子模块
    ```ts
    @Module({
        // 在imports数组中，就是安装好的子模块
        imports: [AdminModule, ApiModule, DefaultModule],
        controllers: [AppController, NewsController, UserController, UploadController],
        providers: [AppService, NewsService],
    })
    export class AppModule{}

### 创建子模块专属的控制器
1.  安装子模块的控制器：``nest g controller module/admin/controller/user``
2.  安装之后，不会在根模块中引入，而是在子模块``admin.module.ts``中引入
    ```ts
    @Module({
        controllers: [UserController]
    })
    export class AdminModule {}
3.  该控制器中配置的路由，仍然可以直接访问，因为子模块已经引入到根模块中
    ```ts
    // 匹配路由 /user
    @Controller('user')
    export class UserController {
        @Get()
        index(): string {
            return '我是admin模块中的用户页面'
        }
    }
4.  当安装子模块的控制器时，只要设置在子模块目录下，控制器就属于该子模块，并且控制器名称即为模块名
    - 如：``nest g controller module/api``， 就在src/module/api目录中，安装了子模块api

### 创建子模块专属的服务
1.  安装子模块的服务：``nest g service module/admin/service/news``
2.  安装之后，不会在根模块中引入，而是在子模块``admin.module.ts``中引入
    ```ts
    @Module({
        providers: [NewsService]
    })
    export class AdminModule {}
3.  子模块的服务，只能在子模块的控制器中使用

### 在子模块中，使用公共服务
1.  公共服务都在根模块``app.module.ts``中引入，而子模块中没有引入，因此无法使用公共服务
    ```ts
    @Module({
        imports: [AdminModule, ApiModule, DefaultModule],
        controllers: [AppController, NewsController, UserController, UploadController],
        providers: [AppService, NewsService],
    })
    export class AppModule{}
2.  在子模块中引入公共服务
    ```ts
    // 引入公共服务
    import { AppService } from '../../app.service'
    @Module({
        controllers: [UserController, NewsController],
        // 配置公共服务
        providers: [NewsService, AppService]
    })
    export class AdminModule {}
3.  在子模块的控制器中，使用公共服务提供的方法
    ```ts
    // 引入公共服务
    import { AppService } from '../../../../app.service'
    @Controller('admin/user')
    export class UserController {
        // 通过公共服务，实例化一个私有对象
        constructor(private appService: AppService) {}
        @Get()
        index(): string {
            // 调用这个私有对象的方法，即公共服务提供的方法
            console.log(this.appService.getHello());
            return '我是admin模块中的用户页面'
        }
    }

### 在子模块中，使用其它模块的服务
- 方法一：与使用公共服务相同
- 方法二：
    1.  在其他模块中导出服务
        ```ts
        @Module({
            controllers: [ApiController],
            providers: [ApiService],
            // 导出要共享的服务
            exports: [ApiService]
        })
        export class ApiModule {}
    2.  在子模块中，引入导出服务的模块即可
        ```ts
        // 引入模块
        import { ApiModule } from '../api/api.module';
        @Module({
            // 引入模块即可，无需引入服务
            imports: [ApiModule],
            controllers: [UserController, NewsController],
            providers: [NewsService, AppService]
        })
        export class AdminModule {}
    3.  在控制器中，可以直接使用服务
        ```ts
        import { ApiService } from '../../../api/api.service'
        @Controller('admin/user')
        export class UserController {
            constructor(private apiService: ApiService) {}
            @Get()
            index(): string {
                console.log(this.apiService.getHello());
                return '我是admin模块中的用户页面'
            }
        }
- 根模块中的服务，无法使用方法二引入到子模块中

### 