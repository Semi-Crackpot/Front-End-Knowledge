# 模块化

### http模块
- 创建服务
    ```js
    // 引入http模块
    const http = require('http');
    // createServer：创建服务
    // request：url传过来的信息
    // response：给浏览器响应信息
    http.createServer(function(request, response) {
        // 设置响应头，状态码200，文件类型html，字符集utf-8
        response.writeHead(200, { 'Content-type': 'text/html; charset = "utf-8"' });
        // 解决浏览器的中文编码问题
        response.write('<head><meta charset="UTF-8"></head>');
        // 在网页上输出内容，输出时会自动解析html标签
        response.write('你好啊Nodejs');
        // 在网页上输出内容，同时结束响应
        response.end('Hello World');
    // 监听的端口号
    }).listen(8081);

### url模块
- 解析浏览器url传过来的信息
    ```js
    const http = require('http');
    // 引入url模块
    const url = require('url');
    http.createServer(function(req, res) {
        res.writeHead(200, { 'Content-type': 'text/html; charset = "utf-8"' });
        res.write('<head><meta charset="UTF-8"></head>');
        // 若不在url后面拼接query或路径，则req.url会打印出/favicon.ico和/，因此进行排除
        if (req.url != '/favicon.ico' && req.url != '/') {
            // 使用parse方法对req.url进行解析，第二个参数true决定是否将解析结果的query转换成对象
            var userInfo = url.parse(req.url, true);
            var userInfo = url.parse(req.url, true).query;
            console.log(userInfo);
        }
        res.end();
    }).listen(8081);
- ``url.parse(req.url, true)``的解析结果
    ```js
    // 解析结果是一个Url对象，可以直接用.来获取对象中的属性
    Url {
        // HTTP协议
        protocol: null,
        slashes: null,
        auth: null,
        // 主机
        host: null,
        // 端口
        port: null,
        // 主机名
        hostname: null,
        hash: null,
        search: '?name=wyz',
        // query
        query: [Object: null prototype] { name: 'wyz' },
        // 路径名
        pathname: '/aaa',
        // 路径，包括后面的query
        path: '/aaa?name=wyz',
        href: '/aaa?name=wyz'
    }
- ``url.parse(req.url, true).query``的解析结果
    ```js
    // 如果传入第二个参数true，解析得到的Url对象的query也是一个对象；如果不传入，则query只是一个字符串
    [Object: null prototype] { name: 'wyz' }
    // 可以通过.来获取query的值
    console.log(userInfo.name); // wyz

### 自定义模块
- 自定义模块的导出方式
    ```js
    var obj = {
        get() {
            console.log(1);
        },
        post() {
            console.log(2);
        }
    }
    module.exports = obj;
- 自定义模块的导入方式
    ```js
    const getData = require('tools');
    getData.get(); // 1
- 当指定从tools目录下导入模块时，实际上是从tools目录下的index.js文件中导入模块
    - 在Nodejs中，自定义模块都放在``node_modules``目录下，导入模块时，指定的目录会自动去node_modules目录中查找
    - 在Nodejs中，导入模块只需指定目录，它会自动寻找该目录下的``index.js``文件
- 修改入口文件的方式
    1.  在模块目录下执行``npm init``，生成``package.json``配置文件
    2.  在``package.json``文件中，修改配置项``"main": "index.js"``

### fs模块
- 文件操作
1.  导入模块
    ```js
    const fs = require('fs')
2.  检测是文件还是目录
    ```js
    fs.stat('./index.html', (err, data) => {
        if (err) {
            console.log(err);
            return;
        }
        console.log(`是文件：${data.isFile()}`);
        console.log(`是目录：${data.isDirectory()}`);
    })
3.  创建目录
    ```js
    fs.mkdir('./css', (err) => {
        if (err) {
            console.log(err);
            return;
        }
        console.log('创建成功');
    })
4.  创建文件
    ```js
    fs.writeFile('./index.html', '写入的内容', (err) => {
        if (err) {
            console.log(err);
            return;
        }
        console.log("创建文件成功");
    })
5.  追加文件内容
    ```js
    fs.appendFile('./index.html', '追加的内容', (err) => {
        if (err) {
            console.log(err);
            return;
        }
        console.log('追加内容成功');
    })
6.  读取文件
    ```js
    fs.readFile('./index.html', (err, data) => {
        if (err) {
            console.log(err);
            return;
        }
        console.log(data); // 内容的Buffer编码
        console.log(data.toString()); // 将内容转化为字符串
    })
7.  读取目录
    ```js
    fs.readdir('./node_modules', (err, data) => {
        if (err) {
            console.log(err);
            return;
        }
        console.log(data);
    })
8.  重命名或移动文件
    ```js
    fs.rename('./index.html', './css/test.css', (err) => {
        if (err) {
            console.log(err);
            return;
        }
    })
9.  删除文件
    ```js
    fs.unlink('./test.js', (err) => {
        if (err) {
            console.log(err);
            return;
        }
    })
10. 删除空目录
    ```js
    fs.rmdir('./css', (err) => {
        if (err) {
            console.log(err);
            return;
        }
    })

### 