# 网页生命周期

### 网页的生命周期
- 网页的生命周期，分为6个阶段
  1.  Active 阶段：网页处于可见状态，且拥有输入焦点
  2.  Passive 阶段：网页可见，但没有输入焦点，无法接受输入，该阶段只可能发生在桌面同时有多个窗口的情况
  3.  Hidden 阶段：用户的桌面被其他窗口占据，网页不可见，但尚未冻结
  4.  Terminated 阶段：由于用户主动关闭窗口，或者在同一个窗口前往其他页面，导致当前页面开始被浏览器卸载并从内存中清除
    - 用户主动离开当前页面，总是先进入 Hidden 阶段，再进入 Terminated 阶段
  5.  Frozen 阶段：如果网页处于 Hidden 阶段的时间过久，用户又不关闭网页，浏览器就有可能冻结网页，使其进入 Frozen 阶段
  6.  Discarded 阶段：如果网页长时间处于 Frozen 阶段，用户又不唤醒页面，那么就会进入 Discarded 阶段，即浏览器自动卸载网页，清除该网页的内存占用

### 网页生命周期变化的常见场景
1.  用户打开网页后，又切换到其他 App，但只过了一会又回到网页
  - 网页由 Active 变成 Hidden，又变回 Active
2.  用户打开网页后，又切换到其他 App，并且长时候使用后者，导致系统自动丢弃网页
  - 网页由 Active 变成 Hidden，再变成 Frozen，最后 Discarded
3.  用户打开网页后，又切换到其他 App，然后从任务管理器里面将浏览器进程清除
  - 网页由 Active 变成 Hidden，然后 Terminated
4.  系统丢弃了某个 Tab 里面的页面后，用户重新打开这个 Tab
  - 网页由 Discarded 变成 Active

### 生命周期阶段的事件
1.  focus 事件：在页面获得输入焦点时触发，比如网页从 Passive 阶段变为 Active 阶段
2.  blur 事件：在页面失去输入焦点时触发，比如网页从 Active 阶段变为 Passive 阶段
3.  visibilitychange 事件：网页可见状态发生变化时触发
  - 用户隐藏页面（切换 Tab、最小化浏览器），页面由 Active 阶段变成 Hidden 阶段
  - 用户重新访问隐藏的页面，页面由 Hidden 阶段变成 Active 阶段
  - 用户关闭页面，页面会先进入 Hidden 阶段，然后进入 Terminated 阶段
4.  freeze 事件：在网页进入 Frozen 阶段时触发
5.  resume 事件：在网页离开 Frozen 阶段，变为 Active / Passive / Hidden 阶段时触发

### 获取当前阶段
1.  获取Active、Passive 或 Hidden 阶段
  ```js
  const getState = () => {
    if (document.visibilityState === 'hidden') {
      return 'hidden';
    }
    if (document.hasFocus()) {
      return 'active';
    }
    return 'passive';
  };
  ```
2.  获取 Frozen 阶段：监听freeze事件
  ```js
  document.onfreeze = function() { ... }
  ```
3.  获取 Terminated 状态：监听pagehide事件
  
### 