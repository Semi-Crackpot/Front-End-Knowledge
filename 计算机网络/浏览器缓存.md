# 缓存

### 缓存过程分析
1.  浏览器与服务器通信的方式为应答模式，即：浏览器发起HTTP请求 –> 服务器响应该请求
2.  浏览器每次发起请求，都会先在浏览器缓存中查找该请求的结果以及缓存标识
3.  如果没有，就向服务器发起HTTP请求，服务器返回请求结果和缓存标识
4.  浏览器将返回的请求结果和缓存标识存入浏览器缓存中

### 强制缓存
1.  什么是强制缓存
    - 强制缓存就是向浏览器缓存查找该请求结果，并根据该结果的缓存标识来决定是否使用该`缓存结果`的过程
2.  强制缓存的三种情况
    - 不存在该缓存结果和缓存标识，强制缓存失效，则直接向服务器发起请求
    - 存在该缓存结果和缓存标识，但该结果已失效，强制缓存失效，则使用协商缓存
    - 存在该缓存结果和缓存标识，且该结果尚未失效，强制缓存生效，直接返回该结果

### Expires
1.  Expires是HTTP1.0控制网页缓存的字段，其值为缓存结果的到期时间
2.  到了HTTP1.1，Expire已经被Cache-Control替代
3.  因为Expires控制缓存的原理是使用客户端的时间与服务端返回的时间做对比，如果客户端与服务端的时间因为某些原因发生误差，则强制缓存失效

### Cache-Control
1.  Cache-Control是HTTP/1.1中，用于控制网页缓存的字段
2.  Cache-Control的取值
    - public：所有内容都将被缓存（客户端和代理服务器都可缓存）
    - private：所有内容只有客户端可以缓存，Cache-Control的默认取值
    - no-cache：客户端缓存内容，但是是否使用缓存则需要经过协商缓存来验证决定
    - no-store：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存
    - max-age=xxx (xxx is numeric)：缓存内容的失效时间
3.  `Expires`和`Cache-Control`的时间区别
    - Expires的时间值，是一个绝对值
    - Cache-Control的时间值，是一个相对值，由max-age决定

### 浏览器缓存放在哪里
1.  打开浏览器网页时，浏览器会在js和图片等文件解析执行后直接存入`内存缓存`中，当刷新页面时，只需直接从内存缓存中读取(from memory cache)
2.  而css文件则会存入硬盘文件中，所以每次渲染页面（包括打开页面和刷新页面）都需要从硬盘读取缓存(from disk cache)

### 协商缓存
1.  什么是协商缓存
    - 协商缓存就是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程
2.  协商缓存的两种情况
    - 协商缓存生效，返回304：协商缓存1.jpg
    - 协商缓存失效，返回200和请求结果：协商缓存2.jpg
3.  协商缓存的标识
    - 协商缓存的标识是在响应报文的HTTP头中和请求结果一起返回给浏览器的

### 